<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤ - STAYGO</title>
    <link rel="icon" type="image/png" href="../../games/reveal-board/staygo-logo.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Kanit:wght@700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../../assets/css/site.css" />
    <script defer src="../../assets/js/config.js"></script>
    <script defer src="../../assets/js/site.js"></script>
  </head>
  <body>
    <header class="header">
      <div class="container">
        <div class="header-content">
          <a href="../../" class="logo-link">
            <img src="../../games/reveal-board/staygo-logo.png" alt="Staygo" class="logo" />
          </a>
          
          <nav class="nav" aria-label="‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å">
            <a href="../../#play" class="nav-link">Play</a>
            <a href="../../#tools" class="nav-link active">Tools</a>
            <a href="../../#watch" class="nav-link">Watch & Play</a>
            <a href="../../#about" class="nav-link">About</a>
          </nav>

          <div class="header-actions">
            <a href="https://www.youtube.com/@STAYGO" target="_blank" rel="noopener noreferrer" class="icon-button" aria-label="YouTube">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"></path>
                <polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"></polygon>
              </svg>
            </a>
            <button id="menuToggle" class="icon-button" aria-label="‡πÄ‡∏°‡∏ô‡∏π">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Mobile Menu -->
    <div id="mobileMenu" class="mobile-menu">
      <div class="mobile-menu-header">
        <span class="mobile-menu-title">‡πÄ‡∏°‡∏ô‡∏π</span>
        <button id="menuClose" class="icon-button" aria-label="‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏ô‡∏π">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <nav class="mobile-nav">
        <a href="../../#play" class="mobile-nav-link">Play</a>
        <a href="../../#tools" class="mobile-nav-link">Tools</a>
        <a href="../../#watch" class="mobile-nav-link">Watch & Play</a>
        <a href="../../#about" class="mobile-nav-link">About</a>
      </nav>
    </div>

    <main>
      <section class="section">
        <div class="container">
          <div class="dice-header">
            <h1 class="section-title">üé≤ ‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤</h1>
            <a href="../../#tools" class="button button-ghost button-sm">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</a>
          </div>

          <!-- Dice Display Area -->
          <div class="dice-display-section">
            <div class="dice-result-container" id="diceResultContainer">
              <div class="dice-placeholder">
                <div class="dice-placeholder-icon">üé≤</div>
                <p class="dice-placeholder-text">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏ó‡∏≠‡∏¢</p>
              </div>
            </div>
            <div class="dice-total" id="diceTotal"></div>
          </div>

          <!-- Controls Panel -->
          <div class="dice-controls">
            <div class="dice-control-section">
              <h3 class="dice-section-title">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤</h3>
              
              <!-- Dice Type Tabs -->
              <div class="dice-type-tabs">
                <button class="dice-type-tab active" data-tab="standard">Standard Dice</button>
                <button class="dice-type-tab" data-tab="custom">Custom Dice</button>
              </div>

              <!-- Standard Dice Panel -->
              <div class="dice-type-panel active" id="standardPanel">
                <div class="dice-type-grid">
                  <button class="dice-type-button" data-faces="6">
                    <span class="dice-type-label">D6</span>
                    <span class="dice-type-desc">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
                  </button>
                  <button class="dice-type-button" data-faces="3">
                    <span class="dice-type-label">D3</span>
                    <span class="dice-type-desc">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
                  </button>
                  <button class="dice-type-button" data-faces="4">
                    <span class="dice-type-label">D4</span>
                    <span class="dice-type-desc">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
                  </button>
                  <button class="dice-type-button" data-faces="8">
                    <span class="dice-type-label">D8</span>
                    <span class="dice-type-desc">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
                  </button>
                  <button class="dice-type-button" data-faces="10">
                    <span class="dice-type-label">D10</span>
                    <span class="dice-type-desc">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
                  </button>
                  <button class="dice-type-button" data-faces="12">
                    <span class="dice-type-label">D12</span>
                    <span class="dice-type-desc">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
                  </button>
                  <button class="dice-type-button" data-faces="20">
                    <span class="dice-type-label">D20</span>
                    <span class="dice-type-desc">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
                  </button>
                  <button class="dice-type-button" data-faces="100">
                    <span class="dice-type-label">D100</span>
                    <span class="dice-type-desc">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
                  </button>
                </div>
              </div>

              <!-- Custom Dice Panel -->
              <div class="dice-type-panel" id="customPanel">
                <div class="dice-custom-input">
                  <label for="customFaces" class="dice-custom-label">
                    <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤</span>
                    <span class="dice-custom-sublabel">(2-999)</span>
                  </label>
                  <div style="display: flex; gap: 12px;">
                    <input 
                      type="number" 
                      id="customFaces" 
                      class="dice-number-input" 
                      min="2" 
                      max="999" 
                      value="6"
                      placeholder="‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πâ‡∏≤"
                      style="flex: 1;"
                    />
                    <button class="button button-primary button-md" id="addCustomDice">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Dice Queue Section -->
            <div class="dice-control-section">
              <div class="dice-queue-header">
                <h3 class="dice-section-title">‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ó‡∏≠‡∏¢ (<span id="diceQueueCount">0</span>)</h3>
                <button class="button button-ghost button-sm" id="clearQueue">‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
              </div>
              <div class="dice-queue" id="diceQueue">
                <div class="dice-queue-empty">
                  <p class="muted">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤</p>
                </div>
              </div>
            </div>

            <button class="button button-primary button-lg dice-roll-button" id="rollButton" disabled>
              üé≤ ‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤
            </button>
          </div>

          <!-- History Section -->
          <div class="dice-history-section">
            <div class="dice-history-header">
              <h3 class="dice-section-title">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≠‡∏¢</h3>
              <button class="button button-outline button-sm" id="clearHistoryBtn">‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
            </div>
            <div class="dice-history-list" id="historyList">
              <div class="dice-history-empty">
                <p class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≠‡∏¢</p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal">
      <div class="modal-overlay" id="modalOverlay"></div>
      <div class="modal-content">
        <h3 class="modal-title">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h3>
        <p class="modal-text">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≠‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
        <div class="modal-actions">
          <button class="button button-outline button-md" id="cancelBtn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button class="button button-primary button-md" id="confirmBtn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-logo">
            <img src="./games/reveal-board/staygo-logo.png" alt="Staygo" />
          </div>
          
          <nav class="footer-links">
            <a href="https://facebook.com/STAYG0" target="_blank" rel="noopener noreferrer">Facebook</a>
            <a href="https://instagram.com/staygo.official" target="_blank" rel="noopener noreferrer">Instagram</a>
            <a href="https://tiktok.com/@staygo.official" target="_blank" rel="noopener noreferrer">TikTok</a>
            <a href="https://twitch.tv/staygogamming" target="_blank" rel="noopener noreferrer">Twitch</a>
          </nav>
          
          <p class="footer-copy">¬© STAYGO 2025</p>
        </div>
      </div>
    </footer>

    <script>
      class DiceRoller {
        constructor() {
          this.diceQueue = [];
          this.history = [];
          this.isRolling = false;
          
          this.init();
        }

        init() {
          // Dice type tabs
          document.querySelectorAll('.dice-type-tab').forEach(tab => {
            tab.addEventListener('click', (e) => this.switchTab(e.target.dataset.tab));
          });

          // Standard dice buttons - now adds to queue
          document.querySelectorAll('.dice-type-button').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const faces = parseInt(e.currentTarget.dataset.faces);
              this.addDiceToQueue(faces, false);
            });
          });

          // Custom dice button
          document.getElementById('addCustomDice').addEventListener('click', () => {
            const faces = parseInt(document.getElementById('customFaces').value) || 6;
            if (faces >= 2 && faces <= 999) {
              this.addDiceToQueue(faces, true);
            }
          });

          // Clear queue
          document.getElementById('clearQueue').addEventListener('click', () => this.clearQueue());

          // Roll button
          document.getElementById('rollButton').addEventListener('click', () => this.roll());

          // History clear
          document.getElementById('clearHistoryBtn').addEventListener('click', () => this.showClearConfirmation());
          document.getElementById('cancelBtn').addEventListener('click', () => this.hideModal());
          document.getElementById('confirmBtn').addEventListener('click', () => this.clearHistory());
          document.getElementById('modalOverlay').addEventListener('click', () => this.hideModal());
        }

        switchTab(tab) {
          // Update tabs
          document.querySelectorAll('.dice-type-tab').forEach(t => t.classList.remove('active'));
          document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
          
          // Update panels
          document.querySelectorAll('.dice-type-panel').forEach(p => p.classList.remove('active'));
          document.getElementById(tab === 'standard' ? 'standardPanel' : 'customPanel').classList.add('active');
        }

        addDiceToQueue(faces, isCustom) {
          this.diceQueue.push({ faces, isCustom });
          this.renderQueue();
        }

        removeDiceFromQueue(index) {
          this.diceQueue.splice(index, 1);
          this.renderQueue();
        }

        clearQueue() {
          if (this.diceQueue.length === 0) return;
          this.diceQueue = [];
          this.renderQueue();
        }

        renderQueue() {
          const queueElement = document.getElementById('diceQueue');
          const countElement = document.getElementById('diceQueueCount');
          const rollButton = document.getElementById('rollButton');
          
          countElement.textContent = this.diceQueue.length;

          if (this.diceQueue.length === 0) {
            queueElement.innerHTML = '<div class="dice-queue-empty"><p class="muted">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤</p></div>';
            rollButton.disabled = true;
            return;
          }

          rollButton.disabled = false;

          // Group dice by faces for display
          const grouped = {};
          this.diceQueue.forEach((dice, index) => {
            const key = `${dice.isCustom ? 'Custom-' : ''}D${dice.faces}`;
            if (!grouped[key]) {
              grouped[key] = { faces: dice.faces, isCustom: dice.isCustom, indices: [] };
            }
            grouped[key].indices.push(index);
          });

          queueElement.innerHTML = Object.entries(grouped).map(([key, data]) => `
            <div class="dice-queue-item">
              <span class="dice-queue-label">
                ${data.count || data.indices.length}√ó ${data.isCustom ? 'Custom ' : ''}D${data.faces}
              </span>
              <button class="dice-queue-remove" data-indices="${data.indices.join(',')}">√ó</button>
            </div>
          `).join('');

          // Add remove handlers
          queueElement.querySelectorAll('.dice-queue-remove').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const indices = e.target.dataset.indices.split(',').map(Number);
              // Remove from highest index to lowest to avoid index shifting
              indices.sort((a, b) => b - a).forEach(index => {
                this.removeDiceFromQueue(index);
              });
            });
          });
        }

        async roll() {
          if (this.isRolling || this.diceQueue.length === 0) return;
          this.isRolling = true;

          const results = [];
          const container = document.getElementById('diceResultContainer');
          
          // Clear placeholder
          container.innerHTML = '';
          
          // Create dice elements for each die in queue
          this.diceQueue.forEach((dice, i) => {
            const diceElement = document.createElement('div');
            diceElement.className = 'dice-item rolling';
            diceElement.innerHTML = `
              <div class="dice-face">?</div>
              <div class="dice-type-badge">${dice.isCustom ? 'C' : ''}D${dice.faces}</div>
            `;
            container.appendChild(diceElement);
          });

          // Animate rolling
          await new Promise(resolve => setTimeout(resolve, 100));

          // Roll each die
          for (let i = 0; i < this.diceQueue.length; i++) {
            const dice = this.diceQueue[i];
            const result = Math.floor(Math.random() * dice.faces) + 1;
            results.push({ faces: dice.faces, isCustom: dice.isCustom, result });
            
            // Stagger the reveal
            await new Promise(resolve => setTimeout(resolve, 150));
            
            const diceElement = container.children[i];
            diceElement.classList.remove('rolling');
            diceElement.classList.add('revealed');
            diceElement.querySelector('.dice-face').textContent = result;
          }

          // Calculate and show total
          const total = results.reduce((sum, r) => sum + r.result, 0);
          document.getElementById('diceTotal').innerHTML = `
            <span class="dice-total-label">‡∏ú‡∏•‡∏£‡∏ß‡∏°:</span>
            <span class="dice-total-value">${total}</span>
          `;

          // Add to history
          const historyItem = {
            timestamp: new Date().toISOString(),
            dice: this.diceQueue.map(d => ({ faces: d.faces, isCustom: d.isCustom })),
            results: results.map(r => r.result),
            total: total
          };
          
          this.history.unshift(historyItem);
          if (this.history.length > 50) this.history.pop();
          
          this.renderHistory();
          
          this.isRolling = false;
        }

        renderHistory() {
          const historyList = document.getElementById('historyList');
          
          if (this.history.length === 0) {
            historyList.innerHTML = '<div class="dice-history-empty"><p class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≠‡∏¢</p></div>';
            return;
          }

          historyList.innerHTML = this.history.map((item) => {
            const date = new Date(item.timestamp);
            const timeStr = date.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            
            // Group dice types for display
            const diceGroups = {};
            item.dice.forEach(dice => {
              const key = `${dice.isCustom ? 'C' : ''}D${dice.faces}`;
              diceGroups[key] = (diceGroups[key] || 0) + 1;
            });
            
            const diceStr = Object.entries(diceGroups)
              .map(([key, count]) => `${count}√ó ${key}`)
              .join(' + ');
            
            return `
              <div class="dice-history-item">
                <div class="dice-history-header-row">
                  <span class="dice-history-time">${timeStr}</span>
                  <span class="dice-history-type">${diceStr}</span>
                  <span class="dice-history-total">‡∏£‡∏ß‡∏°: ${item.total}</span>
                </div>
                <div class="dice-history-results">
                  ${item.results.map((r, i) => {
                    const dice = item.dice[i];
                    return `<span class="dice-history-result" title="${dice.isCustom ? 'C' : ''}D${dice.faces}">${r}</span>`;
                  }).join('')}
                </div>
              </div>
            `;
          }).join('');
        }

        showClearConfirmation() {
          if (this.history.length === 0) return;
          document.getElementById('confirmModal').classList.add('active');
        }

        hideModal() {
          document.getElementById('confirmModal').classList.remove('active');
        }

        clearHistory() {
          this.history = [];
          this.renderHistory();
          this.hideModal();
        }
      }

      // Initialize on page load
      document.addEventListener('DOMContentLoaded', () => {
        new DiceRoller();
      });
    </script>
  </body>
</html>
